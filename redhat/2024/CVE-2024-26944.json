{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-05-01T00:00:00Z",
  "bugzilla": {
    "description": "kernel: btrfs: zoned: fix use-after-free in do_zone_finish()",
    "id": "2278210",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2278210"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-26944",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nbtrfs: zoned: fix use-after-free in do_zone_finish()\nShinichiro reported the following use-after-free triggered by the device\nreplace operation in fstests btrfs/070.\nBTRFS info (device nullb1): scrub: finished on devid 1 with status: 0\n==================================================================\nBUG: KASAN: slab-use-after-free in do_zone_finish+0x91a/0xb90 [btrfs]\nRead of size 8 at addr ffff8881543c8060 by task btrfs-cleaner/3494007\nCPU: 0 PID: 3494007 Comm: btrfs-cleaner Tainted: G        W          6.8.0-rc5-kts #1\nHardware name: Supermicro Super Server/X11SPi-TF, BIOS 3.3 02/21/2020\nCall Trace:\n\u003cTASK\u003e\ndump_stack_lvl+0x5b/0x90\nprint_report+0xcf/0x670\n? __virt_addr_valid+0x200/0x3e0\nkasan_report+0xd8/0x110\n? do_zone_finish+0x91a/0xb90 [btrfs]\n? do_zone_finish+0x91a/0xb90 [btrfs]\ndo_zone_finish+0x91a/0xb90 [btrfs]\nbtrfs_delete_unused_bgs+0x5e1/0x1750 [btrfs]\n? __pfx_btrfs_delete_unused_bgs+0x10/0x10 [btrfs]\n? btrfs_put_root+0x2d/0x220 [btrfs]\n? btrfs_clean_one_deleted_snapshot+0x299/0x430 [btrfs]\ncleaner_kthread+0x21e/0x380 [btrfs]\n? __pfx_cleaner_kthread+0x10/0x10 [btrfs]\nkthread+0x2e3/0x3c0\n? __pfx_kthread+0x10/0x10\nret_from_fork+0x31/0x70\n? __pfx_kthread+0x10/0x10\nret_from_fork_asm+0x1b/0x30\n\u003c/TASK\u003e\nAllocated by task 3493983:\nkasan_save_stack+0x33/0x60\nkasan_save_track+0x14/0x30\n__kasan_kmalloc+0xaa/0xb0\nbtrfs_alloc_device+0xb3/0x4e0 [btrfs]\ndevice_list_add.constprop.0+0x993/0x1630 [btrfs]\nbtrfs_scan_one_device+0x219/0x3d0 [btrfs]\nbtrfs_control_ioctl+0x26e/0x310 [btrfs]\n__x64_sys_ioctl+0x134/0x1b0\ndo_syscall_64+0x99/0x190\nentry_SYSCALL_64_after_hwframe+0x6e/0x76\nFreed by task 3494056:\nkasan_save_stack+0x33/0x60\nkasan_save_track+0x14/0x30\nkasan_save_free_info+0x3f/0x60\npoison_slab_object+0x102/0x170\n__kasan_slab_free+0x32/0x70\nkfree+0x11b/0x320\nbtrfs_rm_dev_replace_free_srcdev+0xca/0x280 [btrfs]\nbtrfs_dev_replace_finishing+0xd7e/0x14f0 [btrfs]\nbtrfs_dev_replace_by_ioctl+0x1286/0x25a0 [btrfs]\nbtrfs_ioctl+0xb27/0x57d0 [btrfs]\n__x64_sys_ioctl+0x134/0x1b0\ndo_syscall_64+0x99/0x190\nentry_SYSCALL_64_after_hwframe+0x6e/0x76\nThe buggy address belongs to the object at ffff8881543c8000\nwhich belongs to the cache kmalloc-1k of size 1024\nThe buggy address is located 96 bytes inside of\nfreed 1024-byte region [ffff8881543c8000, ffff8881543c8400)\nThe buggy address belongs to the physical page:\npage:00000000fe2c1285 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x1543c8\nhead:00000000fe2c1285 order:3 entire_mapcount:0 nr_pages_mapped:0 pincount:0\nflags: 0x17ffffc0000840(slab|head|node=0|zone=2|lastcpupid=0x1fffff)\npage_type: 0xffffffff()\nraw: 0017ffffc0000840 ffff888100042dc0 ffffea0019e8f200 dead000000000002\nraw: 0000000000000000 0000000000100010 00000001ffffffff 0000000000000000\npage dumped because: kasan: bad access detected\nMemory state around the buggy address:\nffff8881543c7f00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nffff8881543c7f80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\u003effff8881543c8000: fa fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n^\nffff8881543c8080: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\nffff8881543c8100: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\nThis UAF happens because we're accessing stale zone information of a\nalready removed btrfs_device in do_zone_finish().\nThe sequence of events is as follows:\nbtrfs_dev_replace_start\nbtrfs_scrub_dev\nbtrfs_dev_replace_finishing\nbtrfs_dev_replace_update_device_in_mapping_tree \u003c-- devices replaced\nbtrfs_rm_dev_replace_free_srcdev\nbtrfs_free_device                              \u003c-- device freed\ncleaner_kthread\nbtrfs_delete_unused_bgs\nbtrfs_zone_finish\ndo_zone_finish              \u003c-- refers the freed device\nThe reason for this is that we're using a\n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-26944\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-26944\nhttps://lore.kernel.org/linux-cve-announce/2024050125-CVE-2024-26944-598c@gregkh/T"
  ]
}