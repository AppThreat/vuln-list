{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-06-20T00:00:00Z",
  "bugzilla": {
    "description": "kernel: KVM: x86: Forcibly leave nested virt when SMM state is toggled",
    "id": "2293372",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2293372"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2022-48763",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nKVM: x86: Forcibly leave nested virt when SMM state is toggled\nForcibly leave nested virtualization operation if userspace toggles SMM\nstate via KVM_SET_VCPU_EVENTS or KVM_SYNC_X86_EVENTS.  If userspace\nforces the vCPU out of SMM while it's post-VMXON and then injects an SMI,\nvmx_enter_smm() will overwrite vmx-\u003enested.smm.vmxon and end up with both\nvmxon=false and smm.vmxon=false, but all other nVMX state allocated.\nDon't attempt to gracefully handle the transition as (a) most transitions\nare nonsencial, e.g. forcing SMM while L2 is running, (b) there isn't\nsufficient information to handle all transitions, e.g. SVM wants access\nto the SMRAM save state, and (c) KVM_SET_VCPU_EVENTS must precede\nKVM_SET_NESTED_STATE during state restore as the latter disallows putting\nthe vCPU into L2 if SMM is active, and disallows tagging the vCPU as\nbeing post-VMXON in SMM if SMM is not active.\nAbuse of KVM_SET_VCPU_EVENTS manifests as a WARN and memory leak in nVMX\ndue to failure to free vmcs01's shadow VMCS, but the bug goes far beyond\njust a memory leak, e.g. toggling SMM on while L2 is active puts the vCPU\nin an architecturally impossible state.\nWARNING: CPU: 0 PID: 3606 at free_loaded_vmcs arch/x86/kvm/vmx/vmx.c:2665 [inline]\nWARNING: CPU: 0 PID: 3606 at free_loaded_vmcs+0x158/0x1a0 arch/x86/kvm/vmx/vmx.c:2656\nModules linked in:\nCPU: 1 PID: 3606 Comm: syz-executor725 Not tainted 5.17.0-rc1-syzkaller #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011\nRIP: 0010:free_loaded_vmcs arch/x86/kvm/vmx/vmx.c:2665 [inline]\nRIP: 0010:free_loaded_vmcs+0x158/0x1a0 arch/x86/kvm/vmx/vmx.c:2656\nCode: \u003c0f\u003e 0b eb b3 e8 8f 4d 9f 00 e9 f7 fe ff ff 48 89 df e8 92 4d 9f 00\nCall Trace:\n\u003cTASK\u003e\nkvm_arch_vcpu_destroy+0x72/0x2f0 arch/x86/kvm/x86.c:11123\nkvm_vcpu_destroy arch/x86/kvm/../../../virt/kvm/kvm_main.c:441 [inline]\nkvm_destroy_vcpus+0x11f/0x290 arch/x86/kvm/../../../virt/kvm/kvm_main.c:460\nkvm_free_vcpus arch/x86/kvm/x86.c:11564 [inline]\nkvm_arch_destroy_vm+0x2e8/0x470 arch/x86/kvm/x86.c:11676\nkvm_destroy_vm arch/x86/kvm/../../../virt/kvm/kvm_main.c:1217 [inline]\nkvm_put_kvm+0x4fa/0xb00 arch/x86/kvm/../../../virt/kvm/kvm_main.c:1250\nkvm_vm_release+0x3f/0x50 arch/x86/kvm/../../../virt/kvm/kvm_main.c:1273\n__fput+0x286/0x9f0 fs/file_table.c:311\ntask_work_run+0xdd/0x1a0 kernel/task_work.c:164\nexit_task_work include/linux/task_work.h:32 [inline]\ndo_exit+0xb29/0x2a30 kernel/exit.c:806\ndo_group_exit+0xd2/0x2f0 kernel/exit.c:935\nget_signal+0x4b0/0x28c0 kernel/signal.c:2862\narch_do_signal_or_restart+0x2a9/0x1c40 arch/x86/kernel/signal.c:868\nhandle_signal_work kernel/entry/common.c:148 [inline]\nexit_to_user_mode_loop kernel/entry/common.c:172 [inline]\nexit_to_user_mode_prepare+0x17d/0x290 kernel/entry/common.c:207\n__syscall_exit_to_user_mode_work kernel/entry/common.c:289 [inline]\nsyscall_exit_to_user_mode+0x19/0x60 kernel/entry/common.c:300\ndo_syscall_64+0x42/0xb0 arch/x86/entry/common.c:86\nentry_SYSCALL_64_after_hwframe+0x44/0xae\n\u003c/TASK\u003e"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2022-48763\nhttps://nvd.nist.gov/vuln/detail/CVE-2022-48763\nhttps://lore.kernel.org/linux-cve-announce/2024062009-CVE-2022-48763-862a@gregkh/T"
  ]
}