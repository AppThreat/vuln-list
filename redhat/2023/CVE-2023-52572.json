{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "",
  "public_date": "2024-03-02T00:00:00Z",
  "bugzilla": {
    "description": "kernel: cifs: use-after-free in cifs_demultiplex_thread()",
    "id": "2267746",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2267746"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "0.0",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:N",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "This flaw was found to be a duplicate of CVE-2023-1192. Please see https://access.redhat.com/security/cve/CVE-2023-1192 for information about affected products and security errata.",
  "acknowledgement": "",
  "name": "CVE-2023-52572",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\ncifs: Fix UAF in cifs_demultiplex_thread()\nThere is a UAF when xfstests on cifs:\nBUG: KASAN: use-after-free in smb2_is_network_name_deleted+0x27/0x160\nRead of size 4 at addr ffff88810103fc08 by task cifsd/923\nCPU: 1 PID: 923 Comm: cifsd Not tainted 6.1.0-rc4+ #45\n...\nCall Trace:\n\u003cTASK\u003e\ndump_stack_lvl+0x34/0x44\nprint_report+0x171/0x472\nkasan_report+0xad/0x130\nkasan_check_range+0x145/0x1a0\nsmb2_is_network_name_deleted+0x27/0x160\ncifs_demultiplex_thread.cold+0x172/0x5a4\nkthread+0x165/0x1a0\nret_from_fork+0x1f/0x30\n\u003c/TASK\u003e\nAllocated by task 923:\nkasan_save_stack+0x1e/0x40\nkasan_set_track+0x21/0x30\n__kasan_slab_alloc+0x54/0x60\nkmem_cache_alloc+0x147/0x320\nmempool_alloc+0xe1/0x260\ncifs_small_buf_get+0x24/0x60\nallocate_buffers+0xa1/0x1c0\ncifs_demultiplex_thread+0x199/0x10d0\nkthread+0x165/0x1a0\nret_from_fork+0x1f/0x30\nFreed by task 921:\nkasan_save_stack+0x1e/0x40\nkasan_set_track+0x21/0x30\nkasan_save_free_info+0x2a/0x40\n____kasan_slab_free+0x143/0x1b0\nkmem_cache_free+0xe3/0x4d0\ncifs_small_buf_release+0x29/0x90\nSMB2_negotiate+0x8b7/0x1c60\nsmb2_negotiate+0x51/0x70\ncifs_negotiate_protocol+0xf0/0x160\ncifs_get_smb_ses+0x5fa/0x13c0\nmount_get_conns+0x7a/0x750\ncifs_mount+0x103/0xd00\ncifs_smb3_do_mount+0x1dd/0xcb0\nsmb3_get_tree+0x1d5/0x300\nvfs_get_tree+0x41/0xf0\npath_mount+0x9b3/0xdd0\n__x64_sys_mount+0x190/0x1d0\ndo_syscall_64+0x35/0x80\nentry_SYSCALL_64_after_hwframe+0x46/0xb0\nThe UAF is because:\nmount(pid: 921)               | cifsd(pid: 923)\n-------------------------------|-------------------------------\n| cifs_demultiplex_thread\nSMB2_negotiate                 |\ncifs_send_recv                |\ncompound_send_recv           |\nsmb_send_rqst               |\nwait_for_response          |\nwait_event_state      [1] |\n|  standard_receive3\n|   cifs_handle_standard\n|    handle_mid\n|     mid-\u003eresp_buf = buf;  [2]\n|     dequeue_mid           [3]\nKILL the process      [4] |\nresp_iov[i].iov_base = buf |\nfree_rsp_buf              [5] |\n|   is_network_name_deleted [6]\n|   callback\n1. After send request to server, wait the response until\nmid-\u003emid_state != SUBMITTED;\n2. Receive response from server, and set it to mid;\n3. Set the mid state to RECEIVED;\n4. Kill the process, the mid state already RECEIVED, get 0;\n5. Handle and release the negotiate response;\n6. UAF.\nIt can be easily reproduce with add some delay in [3] - [6].\nOnly sync call has the problem since async call's callback is\nexecuted in cifsd process.\nAdd an extra state to mark the mid state to READY before wakeup the\nwaitter, then it can get the resp safely."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2023-52572\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-52572\nhttps://lore.kernel.org/linux-cve-announce/2024030256-CVE-2023-52572-2b92@gregkh/T/#u"
  ]
}