{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Low",
  "public_date": "2024-03-02T00:00:00Z",
  "bugzilla": {
    "description": "kernel: dma-debug: don't call __dma_entry_alloc_check_leak() under free_entries_lock",
    "id": "2267801",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2267801"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "4.4",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-413",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2023-52516",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\ndma-debug: don't call __dma_entry_alloc_check_leak() under free_entries_lock\n__dma_entry_alloc_check_leak() calls into printk -\u003e serial console\noutput (qcom geni) and grabs port-\u003elock under free_entries_lock\nspin lock, which is a reverse locking dependency chain as qcom_geni\nIRQ handler can call into dma-debug code and grab free_entries_lock\nunder port-\u003elock.\nMove __dma_entry_alloc_check_leak() call out of free_entries_lock\nscope so that we don't acquire serial console's port-\u003elock under it.\nTrimmed-down lockdep splat:\nThe existing dependency chain (in reverse order) is:\n-\u003e #2 (free_entries_lock){-.-.}-{2:2}:\n_raw_spin_lock_irqsave+0x60/0x80\ndma_entry_alloc+0x38/0x110\ndebug_dma_map_page+0x60/0xf8\ndma_map_page_attrs+0x1e0/0x230\ndma_map_single_attrs.constprop.0+0x6c/0xc8\ngeni_se_rx_dma_prep+0x40/0xcc\nqcom_geni_serial_isr+0x310/0x510\n__handle_irq_event_percpu+0x110/0x244\nhandle_irq_event_percpu+0x20/0x54\nhandle_irq_event+0x50/0x88\nhandle_fasteoi_irq+0xa4/0xcc\nhandle_irq_desc+0x28/0x40\ngeneric_handle_domain_irq+0x24/0x30\ngic_handle_irq+0xc4/0x148\ndo_interrupt_handler+0xa4/0xb0\nel1_interrupt+0x34/0x64\nel1h_64_irq_handler+0x18/0x24\nel1h_64_irq+0x64/0x68\narch_local_irq_enable+0x4/0x8\n____do_softirq+0x18/0x24\n...\n-\u003e #1 (\u0026port_lock_key){-.-.}-{2:2}:\n_raw_spin_lock_irqsave+0x60/0x80\nqcom_geni_serial_console_write+0x184/0x1dc\nconsole_flush_all+0x344/0x454\nconsole_unlock+0x94/0xf0\nvprintk_emit+0x238/0x24c\nvprintk_default+0x3c/0x48\nvprintk+0xb4/0xbc\n_printk+0x68/0x90\nregister_console+0x230/0x38c\nuart_add_one_port+0x338/0x494\nqcom_geni_serial_probe+0x390/0x424\nplatform_probe+0x70/0xc0\nreally_probe+0x148/0x280\n__driver_probe_device+0xfc/0x114\ndriver_probe_device+0x44/0x100\n__device_attach_driver+0x64/0xdc\nbus_for_each_drv+0xb0/0xd8\n__device_attach+0xe4/0x140\ndevice_initial_probe+0x1c/0x28\nbus_probe_device+0x44/0xb0\ndevice_add+0x538/0x668\nof_device_add+0x44/0x50\nof_platform_device_create_pdata+0x94/0xc8\nof_platform_bus_create+0x270/0x304\nof_platform_populate+0xac/0xc4\ndevm_of_platform_populate+0x60/0xac\ngeni_se_probe+0x154/0x160\nplatform_probe+0x70/0xc0\n...\n-\u003e #0 (console_owner){-...}-{0:0}:\n__lock_acquire+0xdf8/0x109c\nlock_acquire+0x234/0x284\nconsole_flush_all+0x330/0x454\nconsole_unlock+0x94/0xf0\nvprintk_emit+0x238/0x24c\nvprintk_default+0x3c/0x48\nvprintk+0xb4/0xbc\n_printk+0x68/0x90\ndma_entry_alloc+0xb4/0x110\ndebug_dma_map_sg+0xdc/0x2f8\n__dma_map_sg_attrs+0xac/0xe4\ndma_map_sgtable+0x30/0x4c\nget_pages+0x1d4/0x1e4 [msm]\nmsm_gem_pin_pages_locked+0x38/0xac [msm]\nmsm_gem_pin_vma_locked+0x58/0x88 [msm]\nmsm_ioctl_gem_submit+0xde4/0x13ac [msm]\ndrm_ioctl_kernel+0xe0/0x15c\ndrm_ioctl+0x2e8/0x3f4\nvfs_ioctl+0x30/0x50\n...\nChain exists of:\nconsole_owner --\u003e \u0026port_lock_key --\u003e free_entries_lock\nPossible unsafe locking scenario:\nCPU0                    CPU1\n----                    ----\nlock(free_entries_lock);\nlock(\u0026port_lock_key);\nlock(free_entries_lock);\nlock(console_owner);\n*** DEADLOCK ***\nCall trace:\ndump_backtrace+0xb4/0xf0\nshow_stack+0x20/0x30\ndump_stack_lvl+0x60/0x84\ndump_stack+0x18/0x24\nprint_circular_bug+0x1cc/0x234\ncheck_noncircular+0x78/0xac\n__lock_acquire+0xdf8/0x109c\nlock_acquire+0x234/0x284\nconsole_flush_all+0x330/0x454\nconsol\n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2023-52516\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-52516\nhttps://lore.kernel.org/linux-cve-announce/2024030252-CVE-2023-52516-9b4a@gregkh/T/#u"
  ]
}