{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Low",
  "public_date": "2024-05-21T00:00:00Z",
  "bugzilla": {
    "description": "kernel: riscv: VMAP_STACK overflow detection thread-safe",
    "id": "2282739",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2282739"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "4.4",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-121",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2023-52761",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nriscv: VMAP_STACK overflow detection thread-safe\ncommit 31da94c25aea (\"riscv: add VMAP_STACK overflow detection\") added\nsupport for CONFIG_VMAP_STACK. If overflow is detected, CPU switches to\n`shadow_stack` temporarily before switching finally to per-cpu\n`overflow_stack`.\nIf two CPUs/harts are racing and end up in over flowing kernel stack, one\nor both will end up corrupting each other state because `shadow_stack` is\nnot per-cpu. This patch optimizes per-cpu overflow stack switch by\ndirectly picking per-cpu `overflow_stack` and gets rid of `shadow_stack`.\nFollowing are the changes in this patch\n- Defines an asm macro to obtain per-cpu symbols in destination\nregister.\n- In entry.S, when overflow is detected, per-cpu overflow stack is\nlocated using per-cpu asm macro. Computing per-cpu symbol requires\na temporary register. x31 is saved away into CSR_SCRATCH\n(CSR_SCRATCH is anyways zero since we're in kernel).\nPlease see Links for additional relevant disccussion and alternative\nsolution.\nTested by `echo EXHAUST_STACK \u003e /sys/kernel/debug/provoke-crash/DIRECT`\nKernel crash log below\nInsufficient stack space to handle exception!/debug/provoke-crash/DIRECT\nTask stack:     [0xff20000010a98000..0xff20000010a9c000]\nOverflow stack: [0xff600001f7d98370..0xff600001f7d99370]\nCPU: 1 PID: 205 Comm: bash Not tainted 6.1.0-rc2-00001-g328a1f96f7b9 #34\nHardware name: riscv-virtio,qemu (DT)\nepc : __memset+0x60/0xfc\nra : recursive_loop+0x48/0xc6 [lkdtm]\nepc : ffffffff808de0e4 ra : ffffffff0163a752 sp : ff20000010a97e80\ngp : ffffffff815c0330 tp : ff600000820ea280 t0 : ff20000010a97e88\nt1 : 000000000000002e t2 : 3233206874706564 s0 : ff20000010a982b0\ns1 : 0000000000000012 a0 : ff20000010a97e88 a1 : 0000000000000000\na2 : 0000000000000400 a3 : ff20000010a98288 a4 : 0000000000000000\na5 : 0000000000000000 a6 : fffffffffffe43f0 a7 : 00007fffffffffff\ns2 : ff20000010a97e88 s3 : ffffffff01644680 s4 : ff20000010a9be90\ns5 : ff600000842ba6c0 s6 : 00aaaaaac29e42b0 s7 : 00fffffff0aa3684\ns8 : 00aaaaaac2978040 s9 : 0000000000000065 s10: 00ffffff8a7cad10\ns11: 00ffffff8a76a4e0 t3 : ffffffff815dbaf4 t4 : ffffffff815dbaf4\nt5 : ffffffff815dbab8 t6 : ff20000010a9bb48\nstatus: 0000000200000120 badaddr: ff20000010a97e88 cause: 000000000000000f\nKernel panic - not syncing: Kernel stack overflow\nCPU: 1 PID: 205 Comm: bash Not tainted 6.1.0-rc2-00001-g328a1f96f7b9 #34\nHardware name: riscv-virtio,qemu (DT)\nCall Trace:\n[\u003cffffffff80006754\u003e] dump_backtrace+0x30/0x38\n[\u003cffffffff808de798\u003e] show_stack+0x40/0x4c\n[\u003cffffffff808ea2a8\u003e] dump_stack_lvl+0x44/0x5c\n[\u003cffffffff808ea2d8\u003e] dump_stack+0x18/0x20\n[\u003cffffffff808dec06\u003e] panic+0x126/0x2fe\n[\u003cffffffff800065ea\u003e] walk_stackframe+0x0/0xf0\n[\u003cffffffff0163a752\u003e] recursive_loop+0x48/0xc6 [lkdtm]\nSMP: stopping secondary CPUs\n---[ end Kernel panic - not syncing: Kernel stack overflow ]---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2023-52761\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-52761\nhttps://lore.kernel.org/linux-cve-announce/2024052147-CVE-2023-52761-5ddf@gregkh/T"
  ]
}