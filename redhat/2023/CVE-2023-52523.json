{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-03-02T00:00:00Z",
  "bugzilla": {
    "description": "kernel: bpf, sockmap: Reject sk_msg egress redirects to non-TCP sockets",
    "id": "2267794",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2267794"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2023-52523",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nbpf, sockmap: Reject sk_msg egress redirects to non-TCP sockets\nWith a SOCKMAP/SOCKHASH map and an sk_msg program user can steer messages\nsent from one TCP socket (s1) to actually egress from another TCP\nsocket (s2):\ntcp_bpf_sendmsg(s1)// = sk_prot-\u003esendmsg\ntcp_bpf_send_verdict(s1)// __SK_REDIRECT case\ntcp_bpf_sendmsg_redir(s2)\ntcp_bpf_push_locked(s2)\ntcp_bpf_push(s2)\ntcp_rate_check_app_limited(s2) // expects tcp_sock\ntcp_sendmsg_locked(s2) // ditto\nThere is a hard-coded assumption in the call-chain, that the egress\nsocket (s2) is a TCP socket.\nHowever in commit 122e6c79efe1 (\"sock_map: Update sock type checks for\nUDP\") we have enabled redirects to non-TCP sockets. This was done for the\nsake of BPF sk_skb programs. There was no indention to support sk_msg\nsend-to-egress use case.\nAs a result, attempts to send-to-egress through a non-TCP socket lead to a\ncrash due to invalid downcast from sock to tcp_sock:\nBUG: kernel NULL pointer dereference, address: 000000000000002f\n...\nCall Trace:\n\u003cTASK\u003e\n? show_regs+0x60/0x70\n? __die+0x1f/0x70\n? page_fault_oops+0x80/0x160\n? do_user_addr_fault+0x2d7/0x800\n? rcu_is_watching+0x11/0x50\n? exc_page_fault+0x70/0x1c0\n? asm_exc_page_fault+0x27/0x30\n? tcp_tso_segs+0x14/0xa0\ntcp_write_xmit+0x67/0xce0\n__tcp_push_pending_frames+0x32/0xf0\ntcp_push+0x107/0x140\ntcp_sendmsg_locked+0x99f/0xbb0\ntcp_bpf_push+0x19d/0x3a0\ntcp_bpf_sendmsg_redir+0x55/0xd0\ntcp_bpf_send_verdict+0x407/0x550\ntcp_bpf_sendmsg+0x1a1/0x390\ninet_sendmsg+0x6a/0x70\nsock_sendmsg+0x9d/0xc0\n? sockfd_lookup_light+0x12/0x80\n__sys_sendto+0x10e/0x160\n? syscall_enter_from_user_mode+0x20/0x60\n? __this_cpu_preempt_check+0x13/0x20\n? lockdep_hardirqs_on+0x82/0x110\n__x64_sys_sendto+0x1f/0x30\ndo_syscall_64+0x38/0x90\nentry_SYSCALL_64_after_hwframe+0x63/0xcd\nReject selecting a non-TCP sockets as redirect target from a BPF sk_msg\nprogram to prevent the crash. When attempted, user will receive an EACCES\nerror from send/sendto/sendmsg() syscall."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2023-52523\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-52523\nhttps://lore.kernel.org/linux-cve-announce/2024030253-CVE-2023-52523-5ae2@gregkh/T/#u"
  ]
}