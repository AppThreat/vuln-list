{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-03-06T00:00:00Z",
  "bugzilla": {
    "description": "kernel: IB/ipoib: Fix mcast list locking",
    "id": "2268331",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2268331"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "6.0",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-413",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2023-52587",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nIB/ipoib: Fix mcast list locking\nReleasing the `priv-\u003elock` while iterating the `priv-\u003emulticast_list` in\n`ipoib_mcast_join_task()` opens a window for `ipoib_mcast_dev_flush()` to\nremove the items while in the middle of iteration. If the mcast is removed\nwhile the lock was dropped, the for loop spins forever resulting in a hard\nlockup (as was reported on RHEL 4.18.0-372.75.1.el8_6 kernel):\nTask A (kworker/u72:2 below)       | Task B (kworker/u72:0 below)\n-----------------------------------+-----------------------------------\nipoib_mcast_join_task(work)        | ipoib_ib_dev_flush_light(work)\nspin_lock_irq(\u0026priv-\u003elock)       | __ipoib_ib_dev_flush(priv, ...)\nlist_for_each_entry(mcast,       | ipoib_mcast_dev_flush(dev = priv-\u003edev)\n\u0026priv-\u003emulticast_list, list) |\nipoib_mcast_join(dev, mcast)   |\nspin_unlock_irq(\u0026priv-\u003elock) |\n|   spin_lock_irqsave(\u0026priv-\u003elock, flags)\n|   list_for_each_entry_safe(mcast, tmcast,\n|                  \u0026priv-\u003emulticast_list, list)\n|     list_del(\u0026mcast-\u003elist);\n|     list_add_tail(\u0026mcast-\u003elist, \u0026remove_list)\n|   spin_unlock_irqrestore(\u0026priv-\u003elock, flags)\nspin_lock_irq(\u0026priv-\u003elock)   |\n|   ipoib_mcast_remove_list(\u0026remove_list)\n(Here, `mcast` is no longer on the  |     list_for_each_entry_safe(mcast, tmcast,\n`priv-\u003emulticast_list` and we keep |                            remove_list, list)\nspinning on the `remove_list` of   |  \u003e\u003e\u003e  wait_for_completion(\u0026mcast-\u003edone)\nthe other thread which is blocked  |\nand the list is still valid on     |\nit's stack.)\nFix this by keeping the lock held and changing to GFP_ATOMIC to prevent\neventual sleeps.\nUnfortunately we could not reproduce the lockup and confirm this fix but\nbased on the code review I think this fix should address such lockups.\ncrash\u003e bc 31\nPID: 747      TASK: ff1c6a1a007e8000  CPU: 31   COMMAND: \"kworker/u72:2\"\n--\n[exception RIP: ipoib_mcast_join_task+0x1b1]\nRIP: ffffffffc0944ac1  RSP: ff646f199a8c7e00  RFLAGS: 00000002\nRAX: 0000000000000000  RBX: ff1c6a1a04dc82f8  RCX: 0000000000000000\nwork (\u0026priv-\u003emcast_task{,.work})\nRDX: ff1c6a192d60ac68  RSI: 0000000000000286  RDI: ff1c6a1a04dc8000\n\u0026mcast-\u003elist\nRBP: ff646f199a8c7e90   R8: ff1c699980019420   R9: ff1c6a1920c9a000\nR10: ff646f199a8c7e00  R11: ff1c6a191a7d9800  R12: ff1c6a192d60ac00\nmcast\nR13: ff1c6a1d82200000  R14: ff1c6a1a04dc8000  R15: ff1c6a1a04dc82d8\ndev                    priv (\u0026priv-\u003elock)     \u0026priv-\u003emulticast_list (aka head)\nORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018\n--- \u003cNMI exception stack\u003e ---\n#5 [ff646f199a8c7e00] ipoib_mcast_join_task+0x1b1 at ffffffffc0944ac1 [ib_ipoib]\n#6 [ff646f199a8c7e98] process_one_work+0x1a7 at ffffffff9bf10967\ncrash\u003e rx ff646f199a8c7e68\nff646f199a8c7e68:  ff1c6a1a04dc82f8 \u003c\u003c\u003c work = \u0026priv-\u003emcast_task.work\ncrash\u003e list -hO ipoib_dev_priv.multicast_list ff1c6a1a04dc8000\n(empty)\ncrash\u003e ipoib_dev_priv.mcast_task.work.func,mcast_mutex.owner.counter ff1c6a1a04dc8000\nmcast_task.work.func = 0xffffffffc0944910 \u003cipoib_mcast_join_task\u003e,\nmcast_mutex.owner.counter = 0xff1c69998efec000\ncrash\u003e b 8\nPID: 8        TASK: ff1c69998efec000  CPU: 33   COMMAND: \"kworker/u72:0\"\n--\n#3 [ff646f1980153d50] wait_for_completion+0x96 at ffffffff9c7d7646\n#4 [ff646f1980153d90] ipoib_mcast_remove_list+0x56 at ffffffffc0944dc6 [ib_ipoib]\n#5 [ff646f1980153de8] ipoib_mcast_dev_flush+0x1a7 at ffffffffc09455a7 [ib_ipoib]\n#6 [ff646f1980153e58] __ipoib_ib_dev_flush+0x1a4 at ffffffffc09431a4 [ib_ipoib]\n#7 [ff\n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2023-52587\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-52587\nhttps://lore.kernel.org/linux-cve-announce/2024030644-CVE-2023-52587-5479@gregkh/T"
  ]
}