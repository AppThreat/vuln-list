{
  "mitigation": "On master nodes where etcd has been installed using the container method:\n0. Verify you can connect to etcd without providing TLS authentication credentials. On any master node, check the ETCD_LISTEN_CLIENT_URLS in /etc/etcd/etcd.conf, and use one of the client urls to connect without providing a certificate, eg:\ncurl -4 curl https://10.0.1.1:2379/version -k\n0a. If vulnerable output will show something like this:\n{\"etcdserver\":\"3.2.15\",\"etcdcluster\":\"3.2.0\"}\n0b. If not affected the connection will fail with:\ncurl: (58) NSS: client certificate not found (nickname not specified)\n1. update /etc/etcd/etcd.conf on the master nodes to remove quotes from these fields:\nETCD_PEER_CLIENT_CERT_AUTH=\"true\"\nETCD_CLIENT_CERT_AUTH=\"true\"\neg.\nETCD_PEER_CLIENT_CERT_AUTH=true\nETCD_CLIENT_CERT_AUTH=true\n2. Restart the etcd container service:\nsudo systemctl restart etcd_container\n3. Test if client authentication is now required using the steps from 0. above.",
  "affected_release": [
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "atomic-openshift-0:3.9.31-1.git.0.ef9737b.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "atomic-openshift-descheduler-0:3.9.13-1.git.267.bb59a3f.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "atomic-openshift-dockerregistry-0:3.9.31-1.git.351.1bd46ed.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "atomic-openshift-node-problem-detector-0:3.9.13-1.git.167.5d6b0d4.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "atomic-openshift-web-console-0:3.9.31-1.git.246.bded6a4.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "golang-github-prometheus-node_exporter-0:3.9.31-1.git.890.a55de06.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "mysql-apb-role-0:1.1.11-1.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    },
    {
      "product_name": "Red Hat OpenShift Container Platform 3.9",
      "release_date": "2018-06-27T00:00:00Z",
      "advisory": "RHSA-2018:2013",
      "package": "openshift-ansible-0:3.9.31-1.git.34.154617d.el7",
      "cpe": "cpe:/a:redhat:openshift:3.9::el7"
    }
  ],
  "package_state": null,
  "threat_severity": "Important",
  "public_date": "2018-03-23T00:00:00Z",
  "bugzilla": {
    "description": "openshift-ansible: Incorrectly quoted values in etcd.conf causes disabling of SSL client certificate authentication",
    "id": "1557822",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=1557822"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "9.0",
    "cvss3_scoring_vector": "CVSS:3.0/AV:A/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H",
    "status": "verified"
  },
  "iava": "",
  "cwe": "CWE-287",
  "statement": "This issue affects Openshift Container Platform (OCP) only if you use the container installation method. The container installation method is tech preview in 3.7.1. This issue affected all users who did a containerized etcd in OCP versions 3.7.1-3.6.\nIf etcd is installed via RPM and run via '/usr/bin/etcd' it's not affected by this flaw. You can check if etcd is being run from '/usr//bin/etcd' using a 'ps' command such as this on the master nodes. If Installed via RPM you should get output similar to:\nps -ef | grep etcd\n$/usr/bin/etcd --name=master-0.example.com --data-dir=/var/lib/etcd/ --listen-client-urls=https://10.0.1.1:2379\nIf etcd is installed via the container method running 'docker ps' on the master will show a container running the registry.access.redhat.com/rhel7/etcd image, eg:\nsudo docker ps --filter name=etcd_container\n$704effa9b0cc        registry.access.redhat.com/rhel7/etcd   \"/usr/bin/etcd\"     56 minutes ago      Up 56 minutes                           etcd_container",
  "acknowledgement": "Red Hat would like to thank David Hocky (Comcast) for reporting this issue.",
  "name": "CVE-2018-1085",
  "document_distribution": "",
  "details": [
    "openshift-ansible before versions 3.9.23, 3.7.46 deploys a misconfigured etcd file that causes the SSL client certificate authentication to be disabled. Quotations around the values of ETCD_CLIENT_CERT_AUTH and ETCD_PEER_CLIENT_CERT_AUTH in etcd.conf result in etcd being configured to allow remote users to connect without any authentication if they can access the etcd server bound to the network on the master nodes. An attacker could use this flaw to read and modify all the data about the Openshift cluster in the etcd datastore, potentially adding another compute node, or bringing down the entire cluster.",
    "OpenShift and Atomic Enterprise Ansible deploys a misconfigured etcd file that causes the SSL client certificate authentication to be disabled. Quotations around the values of ETCD_CLIENT_CERT_AUTH and ETCD_PEER_CLIENT_CERT_AUTH in etcd.conf result in etcd being configured to allow remote users to connect without any authentication if they can access the etcd server bound to the network on the master nodes. An attacker could use this flaw to read and modify all the data about the Openshift cluster in the etcd datastore, potentially adding another compute node, or bringing down the entire cluster."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2018-1085\nhttps://nvd.nist.gov/vuln/detail/CVE-2018-1085"
  ]
}