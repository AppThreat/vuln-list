{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Low",
  "public_date": "2024-02-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: scsi: qla2xxx: Reserve extra IRQ vectors",
    "id": "2266814",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2266814"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "4.4",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-476",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2021-46964",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nscsi: qla2xxx: Reserve extra IRQ vectors\nCommit a6dcfe08487e (\"scsi: qla2xxx: Limit interrupt vectors to number of\nCPUs\") lowers the number of allocated MSI-X vectors to the number of CPUs.\nThat breaks vector allocation assumptions in qla83xx_iospace_config(),\nqla24xx_enable_msix() and qla2x00_iospace_config(). Either of the functions\ncomputes maximum number of qpairs as:\nha-\u003emax_qpairs = ha-\u003emsix_count - 1 (MB interrupt) - 1 (default\nresponse queue) - 1 (ATIO, in dual or pure target mode)\nmax_qpairs is set to zero in case of two CPUs and initiator mode. The\nnumber is then used to allocate ha-\u003equeue_pair_map inside\nqla2x00_alloc_queues(). No allocation happens and ha-\u003equeue_pair_map is\nleft NULL but the driver thinks there are queue pairs available.\nqla2xxx_queuecommand() tries to find a qpair in the map and crashes:\nif (ha-\u003emqenable) {\nuint32_t tag;\nuint16_t hwq;\nstruct qla_qpair *qpair = NULL;\ntag = blk_mq_unique_tag(cmd-\u003erequest);\nhwq = blk_mq_unique_tag_to_hwq(tag);\nqpair = ha-\u003equeue_pair_map[hwq]; # \u003c- HERE\nif (qpair)\nreturn qla2xxx_mqueuecommand(host, cmd, qpair);\n}\nBUG: kernel NULL pointer dereference, address: 0000000000000000\n#PF: supervisor read access in kernel mode\n#PF: error_code(0x0000) - not-present page\nPGD 0 P4D 0\nOops: 0000 [#1] SMP PTI\nCPU: 0 PID: 72 Comm: kworker/u4:3 Tainted: G        W         5.10.0-rc1+ #25\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.0.0-prebuilt.qemu-project.org 04/01/2014\nWorkqueue: scsi_wq_7 fc_scsi_scan_rport [scsi_transport_fc]\nRIP: 0010:qla2xxx_queuecommand+0x16b/0x3f0 [qla2xxx]\nCall Trace:\nscsi_queue_rq+0x58c/0xa60\nblk_mq_dispatch_rq_list+0x2b7/0x6f0\n? __sbitmap_get_word+0x2a/0x80\n__blk_mq_sched_dispatch_requests+0xb8/0x170\nblk_mq_sched_dispatch_requests+0x2b/0x50\n__blk_mq_run_hw_queue+0x49/0xb0\n__blk_mq_delay_run_hw_queue+0xfb/0x150\nblk_mq_sched_insert_request+0xbe/0x110\nblk_execute_rq+0x45/0x70\n__scsi_execute+0x10e/0x250\nscsi_probe_and_add_lun+0x228/0xda0\n__scsi_scan_target+0xf4/0x620\n? __pm_runtime_resume+0x4f/0x70\nscsi_scan_target+0x100/0x110\nfc_scsi_scan_rport+0xa1/0xb0 [scsi_transport_fc]\nprocess_one_work+0x1ea/0x3b0\nworker_thread+0x28/0x3b0\n? process_one_work+0x3b0/0x3b0\nkthread+0x112/0x130\n? kthread_park+0x80/0x80\nret_from_fork+0x22/0x30\nThe driver should allocate enough vectors to provide every CPU it's own HW\nqueue and still handle reserved (MB, RSP, ATIO) interrupts.\nThe change fixes the crash on dual core VM and prevents unbalanced QP\nallocation where nr_hw_queues is two less than the number of CPUs."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2021-46964\nhttps://nvd.nist.gov/vuln/detail/CVE-2021-46964\nhttps://lore.kernel.org/linux-cve-announce/2024022719-CVE-2021-46964-da8c@gregkh/T/#u"
  ]
}