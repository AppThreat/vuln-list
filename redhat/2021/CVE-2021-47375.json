{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-05-21T00:00:00Z",
  "bugzilla": {
    "description": "kernel: blktrace: Fix uaf in blk_trace access after removing by sysfs",
    "id": "2282370",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2282370"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2021-47375",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nblktrace: Fix uaf in blk_trace access after removing by sysfs\nThere is an use-after-free problem triggered by following process:\nP1(sda)P2(sdb)\necho 0 \u003e /sys/block/sdb/trace/enable\nblk_trace_remove_queue\nsynchronize_rcu\nblk_trace_free\nrelay_close\nrcu_read_lock\n__blk_add_trace\ntrace_note_tsk\n(Iterate running_trace_list)\nrelay_close_buf\nrelay_destroy_buf\nkfree(buf)\ntrace_note(sdb's bt)\nrelay_reserve\nbuf-\u003eoffset \u003c- nullptr deference (use-after-free) !!!\nrcu_read_unlock\n[  502.714379] BUG: kernel NULL pointer dereference, address:\n0000000000000010\n[  502.715260] #PF: supervisor read access in kernel mode\n[  502.715903] #PF: error_code(0x0000) - not-present page\n[  502.716546] PGD 103984067 P4D 103984067 PUD 17592b067 PMD 0\n[  502.717252] Oops: 0000 [#1] SMP\n[  502.720308] RIP: 0010:trace_note.isra.0+0x86/0x360\n[  502.732872] Call Trace:\n[  502.733193]  __blk_add_trace.cold+0x137/0x1a3\n[  502.733734]  blk_add_trace_rq+0x7b/0xd0\n[  502.734207]  blk_add_trace_rq_issue+0x54/0xa0\n[  502.734755]  blk_mq_start_request+0xde/0x1b0\n[  502.735287]  scsi_queue_rq+0x528/0x1140\n...\n[  502.742704]  sg_new_write.isra.0+0x16e/0x3e0\n[  502.747501]  sg_ioctl+0x466/0x1100\nReproduce method:\nioctl(/dev/sda, BLKTRACESETUP, blk_user_trace_setup[buf_size=127])\nioctl(/dev/sda, BLKTRACESTART)\nioctl(/dev/sdb, BLKTRACESETUP, blk_user_trace_setup[buf_size=127])\nioctl(/dev/sdb, BLKTRACESTART)\necho 0 \u003e /sys/block/sdb/trace/enable \u0026\n// Add delay(mdelay/msleep) before kernel enters blk_trace_free()\nioctl$SG_IO(/dev/sda, SG_IO, ...)\n// Enters trace_note_tsk() after blk_trace_free() returned\n// Use mdelay in rcu region rather than msleep(which may schedule out)\nRemove blk_trace from running_list before calling blk_trace_free() by\nsysfs if blk_trace is at Blktrace_running state."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2021-47375\nhttps://nvd.nist.gov/vuln/detail/CVE-2021-47375\nhttps://lore.kernel.org/linux-cve-announce/2024052141-CVE-2021-47375-8849@gregkh/T"
  ]
}