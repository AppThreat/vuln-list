{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-02-28T00:00:00Z",
  "bugzilla": {
    "description": "kernel: Bluetooth: avoid deadlock between hci_dev-\u0026gt;lock and socket lock",
    "id": "2266998",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2266998"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.7",
    "cvss3_scoring_vector": "CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-833",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2021-47038",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nBluetooth: avoid deadlock between hci_dev-\u003elock and socket lock\nCommit eab2404ba798 (\"Bluetooth: Add BT_PHY socket option\") added a\ndependency between socket lock and hci_dev-\u003elock that could lead to\ndeadlock.\nIt turns out that hci_conn_get_phy() is not in any way relying on hdev\nbeing immutable during the runtime of this function, neither does it even\nlook at any of the members of hdev, and as such there is no need to hold\nthat lock.\nThis fixes the lockdep splat below:\n======================================================\nWARNING: possible circular locking dependency detected\n5.12.0-rc1-00026-g73d464503354 #10 Not tainted\n------------------------------------------------------\nbluetoothd/1118 is trying to acquire lock:\nffff8f078383c078 (\u0026hdev-\u003elock){+.+.}-{3:3}, at: hci_conn_get_phy+0x1c/0x150 [bluetooth]\nbut task is already holding lock:\nffff8f07e831d920 (sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP){+.+.}-{0:0}, at: l2cap_sock_getsockopt+0x8b/0x610\nwhich lock already depends on the new lock.\nthe existing dependency chain (in reverse order) is:\n-\u003e #3 (sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP){+.+.}-{0:0}:\nlock_sock_nested+0x72/0xa0\nl2cap_sock_ready_cb+0x18/0x70 [bluetooth]\nl2cap_config_rsp+0x27a/0x520 [bluetooth]\nl2cap_sig_channel+0x658/0x1330 [bluetooth]\nl2cap_recv_frame+0x1ba/0x310 [bluetooth]\nhci_rx_work+0x1cc/0x640 [bluetooth]\nprocess_one_work+0x244/0x5f0\nworker_thread+0x3c/0x380\nkthread+0x13e/0x160\nret_from_fork+0x22/0x30\n-\u003e #2 (\u0026chan-\u003elock#2/1){+.+.}-{3:3}:\n__mutex_lock+0xa3/0xa10\nl2cap_chan_connect+0x33a/0x940 [bluetooth]\nl2cap_sock_connect+0x141/0x2a0 [bluetooth]\n__sys_connect+0x9b/0xc0\n__x64_sys_connect+0x16/0x20\ndo_syscall_64+0x33/0x80\nentry_SYSCALL_64_after_hwframe+0x44/0xae\n-\u003e #1 (\u0026conn-\u003echan_lock){+.+.}-{3:3}:\n__mutex_lock+0xa3/0xa10\nl2cap_chan_connect+0x322/0x940 [bluetooth]\nl2cap_sock_connect+0x141/0x2a0 [bluetooth]\n__sys_connect+0x9b/0xc0\n__x64_sys_connect+0x16/0x20\ndo_syscall_64+0x33/0x80\nentry_SYSCALL_64_after_hwframe+0x44/0xae\n-\u003e #0 (\u0026hdev-\u003elock){+.+.}-{3:3}:\n__lock_acquire+0x147a/0x1a50\nlock_acquire+0x277/0x3d0\n__mutex_lock+0xa3/0xa10\nhci_conn_get_phy+0x1c/0x150 [bluetooth]\nl2cap_sock_getsockopt+0x5a9/0x610 [bluetooth]\n__sys_getsockopt+0xcc/0x200\n__x64_sys_getsockopt+0x20/0x30\ndo_syscall_64+0x33/0x80\nentry_SYSCALL_64_after_hwframe+0x44/0xae\nother info that might help us debug this:\nChain exists of:\n\u0026hdev-\u003elock --\u003e \u0026chan-\u003elock#2/1 --\u003e sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP\nPossible unsafe locking scenario:\nCPU0                    CPU1\n----                    ----\nlock(sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP);\nlock(\u0026chan-\u003elock#2/1);\nlock(sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP);\nlock(\u0026hdev-\u003elock);\n*** DEADLOCK ***\n1 lock held by bluetoothd/1118:\n#0: ffff8f07e831d920 (sk_lock-AF_BLUETOOTH-BTPROTO_L2CAP){+.+.}-{0:0}, at: l2cap_sock_getsockopt+0x8b/0x610 [bluetooth]\nstack backtrace:\nCPU: 3 PID: 1118 Comm: bluetoothd Not tainted 5.12.0-rc1-00026-g73d464503354 #10\nHardware name: LENOVO 20K5S22R00/20K5S22R00, BIOS R0IET38W (1.16 ) 05/31/2017\nCall Trace:\ndump_stack+0x7f/0xa1\ncheck_noncircular+0x105/0x120\n? __lock_acquire+0x147a/0x1a50\n__lock_acquire+0x147a/0x1a50\nlock_acquire+0x277/0x3d0\n? hci_conn_get_phy+0x1c/0x150 [bluetooth]\n? __lock_acquire+0x2e1/0x1a50\n? lock_is_held_type+0xb4/0x120\n? hci_conn_get_phy+0x1c/0x150 [bluetooth]\n__mutex_lock+0xa3/0xa10\n? hci_conn_get_phy+0x1c/0x150 [bluetooth]\n? lock_acquire+0x277/0x3d0\n? mark_held_locks+0x49/0x70\n? mark_held_locks+0x49/0x70\n? hci_conn_get_phy+0x1c/0x150 [bluetooth]\nhci_conn_get_phy+0x\n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2021-47038\nhttps://nvd.nist.gov/vuln/detail/CVE-2021-47038\nhttps://lore.kernel.org/linux-cve-announce/2024022837-CVE-2021-47038-bfcf@gregkh/T/#u"
  ]
}